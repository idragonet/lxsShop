var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'),t},addGetWebGLMessage:function(t){var e,a,s;e=void 0!==(t=t||{}).parent?t.parent:document.body,a=void 0!==t.id?t.id:"oldie",(s=Detector.getWebGLErrorMessage()).id=a,e.appendChild(s)}};"object"==typeof module&&(module.exports=Detector),"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(d,p){var s={Scroll:{},Window:{},init:function(t,e,a){this.opt=d.extend({},d.fn.pinBox.defaults,e),this.elem=t,this.Prepare(t),this.OnScroll(t),this.OnResize(t);var s=this;setTimeout(function(){for(var t=a.length-1;0<=t;t--)s.fixContainerHeight(a[t])},1e3)},Prepare:function(t){var e=d(t),a={},s={},i={},n=this.ExtractData(e).pinBoxOptions||this.opt||{};if(!1===n.Disabled){e.parent().is(".pinBox-wrapper")||(e.wrap("<div class='pinBox-wrapper'>"),e.parent().css({position:"relative",zIndex:10}));var r=e.closest(n.Container),o=r.offset();a.top=o.top,a.left=o.left,a.width=r.width(),a.height=r.height();var l=e.offsetParent().offset();s.top=l.top,s.left=l.left,e.parent().css("height",e.outerHeight()),i.width=e.outerWidth(),i.position="fixed",i.left=parseFloat(s.left),i.top=n.Top,i["z-index"]=n.ZIndex,e.data("pinBox",JSON.stringify(i)).data("pinBoxOptions",JSON.stringify(n)).data("pinBoxParent",JSON.stringify(s)).data("pinBoxContainer",JSON.stringify(a))}},ExtractData:function(t){var e={},a=t.data("pinBox")||{},s=t.data("pinBoxOptions")||{},i=t.data("pinBoxParent")||{},n=t.data("pinBoxContainer")||{};return"string"==typeof a&&(e.pinBox=JSON.parse(a)),"string"==typeof s&&(e.pinBoxOptions=JSON.parse(s)),"string"==typeof i&&(e.pinBoxParent=JSON.parse(i)),"string"==typeof n&&(e.pinBoxContainer=JSON.parse(n)),e},OnScroll:function(l){var c=this;d(p).scroll(function(){var t=d(l),e=d(this).scrollTop(),a=c.ExtractData(t),s=a.pinBox,i=a.pinBoxOptions,n=a.pinBoxParent,r=a.pinBoxContainer;if(c.Scroll.direction=e>c.Scroll.current?"down":"up",c.Scroll.current=e,c.Window.width=p.innerWidth||d(p).width(),e>r.top-parseInt(i.Top)&&c.Window.width>parseInt(i.MinWidth)){i.Disabled=!1;var o=t.closest(i.Container).height()-t.outerHeight();(n.top||r.top)+o-parseInt(i.Top)<e?t.attr("style","").css({width:s.width,position:"absolute",top:o}):t.css(s),c.CallEvents(t,!0,i.Disabled)}else c.Window.width<=parseInt(i.MinWidth)?!1===i.Disabled&&(t.attr("style","").unwrap(".pinBox-wrapper"),i.Disabled=!0):t.attr("style","").css({width:s.width}),c.CallEvents(t,!1,i.Disabled);t.data("pinBoxOptions",JSON.stringify(i))})},OnResize:function(a){var s=this,i=d(a);d(p).resize(function(){var t=s.ExtractData(i).pinBoxOptions;if(s.Window.width=p.innerWidth||d(p).width(),t.Disabled=!(s.Window.width>parseInt(t.MinWidth)),!1===t.Disabled){var e=i.parent().width();i.attr("style","").css({width:e})}else i.attr("style","");i.data("pinBoxOptions",JSON.stringify(t)),s.Prepare(a),s.CallEvents(i,!0,t.Disabled)})},CallEvents:function(t,e,a){var s=this;e?t.addClass("active"):t.removeClass("active"),"function"==typeof s.opt.Events&&s.opt.Events.call(t,{current:s.Scroll.current,direction:s.Scroll.direction,width:s.Window.width,active:e,disabled:a})},fixContainerHeight:function(t){var e=d(t),a=this.ExtractData(e),s=a.pinBoxOptions,i=a.pinBoxParent,n=a.pinBoxContainer,r=d(p).scrollTop(),o=e.closest(s.Container).height()-e.outerHeight();(i.top||n.top)+o-parseInt(s.Top)<r&&e.attr("style","").css({width:a.pinBox.width,position:"absolute",top:o,transition:".3s"})}};d.fn.pinBox=function(t){var e=[],a=Object.create(s);this.each(function(){e.push(this),a.init(this,t,e)})},d.fn.pinBox.defaults={Container:".container",Top:0,ZIndex:20,MinWidth:"767px",Events:!1,Disabled:!1}}(jQuery,window,document);var step_obj,step=0,next_step=0,uri="",cur_step="",fa_type_id="",finish_step=0,typecode="",gen_string="",spec_string="",step_arr=new Array,is_show_cad=0,cad_flag=0;function checkLength(t){iCount=t.value.replace(/[^\u0000-\u00ff]/g,"aa"),t.size=iCount.length+2}function Dictionary(){this.data=new Array,this.put=function(t,e){this.data[t]=e},this.get=function(t){return this.data[t]},this.remove=function(t){this.data[t]=null},this.isEmpty=function(){return 0==this.data.length},this.size=function(){return this.data.length}}Array.prototype.remove=function(t){for(var e=0;e<this.length;e++){var a=this[e];if(isNaN(t)||(a=e),a==t){for(var s=e;s<this.length;s++)this[s]=this[s+1];this.length=this.length-1}}};var typecodeOptions=new Dictionary;function toDecimal(t){var e=parseFloat(t);if(!isNaN(e))return e=Math.round(100*t)/100}function format(t){var e,a=(t=t.toString()).split("."),s=a[1];if(3<(e=(t=a[0]).length)){var i=e%3,n=parseInt(e/3),r=[],o=t.substr(0,i);""!=o&&r.push(o);for(var l=0;l<n;l++)r.push(t.substr(i+3*l,3));t=r.join(",")}return t+"."+s}function toDecimal2(t,e){var a=parseFloat(t);if(2==e){var s="";if(-1==(r=(n=a+"").indexOf(".")))s=a.toFixed(2);else if(3<=n.substring(r+1,n.length).length){var i=/([0-9]+.[0-9]{2})[0-9]*/;s=a.toFixed(18).replace(i,"$1")}else s=a.toFixed(2)}else if(1==e){var n,r;s="";if(-1==(r=(n=a+"").indexOf(".")))s=a.toFixed(1);else if(2<=n.substring(r+1,n.length).length){i=/([0-9]+.[0-9]{1})[0-9]*/;s=a.toFixed(3).replace(i,"$1")}else{i=/([0-9]+.[0-9]{1})[0-9]*/;s=a.toFixed(3).replace(i,"$1")}}else 0==e&&(s=Math.floor(a));return s}function format_val(t,e){var a=0;if(/^\-?([1-9]\d*|0)(\.[1-9]{1,3})?$/.test(t)){if(!t||!e)return showErrorMsg("数据有误"),!1;if(2==e)a=toDecimal2(t,2);else if(1==e)a=toDecimal2(t,1);else{if(0!=e)return showErrorMsg("数据有误"),!1;a=toDecimal2(t,0)}}else a=t.toUpperCase();return a}$("#sku-type").on("change",function(){if(!(fa_type_id=$(this).val())||""==fa_type_id||0==fa_type_id)return showErrorMsg("请选择类型码!!"),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$("#sku").val(""),$("#spec_str").val(""),$(".fa-spec").each(function(){$(this).find("input:not(.spr,.is_ex,.is_ex_value)").remove(),$(this).find(".fa-spec-input-div").html(""),$(this).hasClass("ok"),$(this).hasClass("active")&&$(this).removeClass("active"),$(this).hasClass("ok")&&$(this).removeClass("ok")}),$("#last_spec_id").val(0),$("#is_search_over").val(0),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable"),!1;typecode=(typecode=$(this).find("option:selected").text()).split("－")[0],uri=ROOT+"api/get_spec.html",$.ajax({url:uri,type:"post",data:"fa_id="+fa_id+"&fa_type_id="+fa_type_id,dataType:"json",beforeSend:function(){layer.load(2,{shade:!1}),$("#fa-sku .fa-sku-loading-box").show()},error:function(t,e,a){layer.closeAll(),showErrorMsg("数据异常,请联系管理员")},success:function(t){layer.closeAll(),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$(".alert").remove();var e="",a="",s="";if(1==t.status){switch($("#fa-sku .fa-sku-loading-box").hide(),$(".fa-spec").each(function(t){$(this).find("input:not(.spr,.is_ex,.is_ex_value)").remove(),$(this).find(".fa-spec-input-div").html(""),$(this).hasClass("ok")&&$(this).removeClass("ok")}),a=(step_obj=$("#fa-sku-step_"+step)).find(".fa-spec-input-div"),step_obj.hasClass("ok")||step_obj.addClass("ok"),step_obj.find(".fa-spec-value-count").html(t.count),e=a.attr("input_type"),input_spec_id=a.attr("spec_id"),e){case"0":s+="<select input_type='0' cur_step='"+step+"' class='sku-spec sku-ipt' name='spec["+input_spec_id+"]'>",s+="<option value='0'>请选择</option>",$.each(t.data,function(t,e){s+="<option value='"+e.val+"' spec_value_id='"+e.val_id+"'>"+e.val+"</option>"}),s+="</select>";break;case"1":typecodeOptions.isEmpty(),typecodeOptions=new Dictionary,$.each(t.data_arr,function(t,e){typecodeOptions.put(t,e)}),step_arr[0]=typecodeOptions,s+="<input input_type='1' size='10' class='sku-spec sku-ipt' name='spec["+input_spec_id+"]' type='text' spec_value_id='"+t.spec_value_id+"'>",step_obj.find(".fa-spec-value-in_"+step).html("范围:"+t.data_during);break;case"2":$.each(t.data,function(t,e){s+="<input input_type='2' type='radio' class='sku-spec' spec_value_id='"+e.val_id+"' name='spec["+input_spec_id+"]' value='"+e.val+"' > "+e.val+"<br>"})}if(next_step=parseInt(step)+1,a.html(s),$("#sku").show().val(typecode),gen_string=typecode,spec_string=t.spec_str,$("#last_spec_id").val(0),$("#is_search_over").val(0),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$(".sku-add-str").show(),$(".sku-add-tips").hide(),$("#sku-hidden").html($("#sku").val()),$("#sku").width($("#sku-hidden").width()+4),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable"),$(".fa-sku-step").each(function(){$(this).hasClass("active")&&$(this).removeClass("active")}),step_obj.hasClass("active")||step_obj.addClass("active"),1==t.finish){if($("#search_price").hasClass("disable")&&$("#search_price").removeClass("disable"),$(".btn-sku-ex").hasClass("disable")||$(".btn-sku-ex").addClass("disable"),$("#last_spec_id").val(0),$("#is_search_over").val(1),cad_flag=0,$(".sku-add-str").hide(),$("#sku-hidden").html($("#sku-type").val()),$("#sku").width(400),step_obj.hasClass("active")||step_obj.addClass("active"),$(".fa-sku-step").not("#fa-sku-type").each(function(){$(this).hasClass("active")&&$(this).removeClass("active")}),1==is_show_cad)getDrawing($("#sku").val());layer.closeAll()}}else $("#quantity").val(order_num),showErrorMsg(t.msg),$(".fa-price-value").html("-"),$("#last_spec_id").val(0),$("#is_search_over").val(0),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable")}})});var str="",string2="",last_step_obj="",str_arr=new Array,spec_arr=new Array,a=new Array;function search_price(){var t=$("#is_search_over").val(),a=$("#quantity").val(),s=$("#sku").val(),e=$("#sku-type").val();return a&&0!=a?a<order_num?($("#quantity").val(order_num),showErrorMsg("最少起订数量为"+order_num+"！"),!1):t&&0!=t?s&&0!=s?void $.ajax({url:ROOT+"api/search_price",type:"post",data:{flag:t,sku:s,fa_id:fa_id,fa_num:a,typecode:e},dataType:"json",success:function(t){if(1==t.status){if(t.data){data=t.data;var e="无";data.discount<100&&(e=data.discount+"%"),$("#fa_price").html(data.price),$("#fa_price_tax").html(data.price_tax),$("#fa_unit").html(data.unit),$("#fa_total").html(data.total),$("#fa_days").html(data.days),$("#fa_discount").html(e),$("#is_sku_price").val(1),$(".btn-sku-ex").removeClass("disable"),showSuccessMsg("价格查询成功！")}}else if($(".fa-price-value").html("-"),$(".btn-sku-ex").hasClass("disable")||$(".btn-sku-ex").addClass("disable"),2==t.status)quicklogin(1);else{if(3==t.status)return layer.alert(t.info),!1;$("#is_sku_price").val(0),layer.confirm(t.info,{btn:["确定","取消"]},function(){layer.closeAll();var t=$("#goods_name").val(),e=$("#spec_str").val();return $.ajax({type:"POST",url:ROOT+"Quote/ajax_add_sku",data:{goods_id:fa_id,goods_num:a,sku:s,goods_name:t,goods_spec:e},dataType:"json",success:function(t){if(1!=t.status)return layer.msg(t.info,{icon:2,time:1500}),!1;layer.open({type:2,title:"加入询价单成功",skin:"layui-layer-rim",area:["490px","426px"],content:[ROOT+"Quote/ajax_add_fa?fa_id="+fa_id,"no"],success:function(t,e){layer.iframeAuto(e)}})}}),!0},function(t){return layer.close(t),!1})}},error:function(t,e,a){showErrorMsg("数据异常")}}):(showErrorMsg("型号错误或者不完整！"),!1):(showErrorMsg("请生成完整型号！"),!1):(showErrorMsg("请输入数量！"),!1)}$(".sku-spec").live("change",function(){var m="";cur_step=$(this).parent().parent().attr("cur_step"),next_step=parseInt(cur_step)+1;var g="";g=$(this).val(),step_obj=$("#fa-sku-step_"+cur_step),control_div=step_obj.find(".fa-spec-input-div"),step_obj.hasClass("ok")||step_obj.addClass("ok");step_obj.attr("unit");var t=step_obj.attr("spec_id");switch($(this).attr("input_type")){case"0":if(null==(m=$(this).find("option:selected").attr("spec_value_id")))return!1;break;case"1":var e=$(this).val();if(0==e.length)return showErrorMsg("数值不能为空，请输入！"),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$("#last_spec_id").val(0),$("#is_search_over").val(0),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable"),!1;if(0==step_arr[cur_step].length||null==step_arr[cur_step].get(e)){showErrorMsg("数值不在其范围，请重新填写！"),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$("#last_spec_id").val(0),$("#is_search_over").val(0),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable");for(var a=next_step;a<spec_num;a++)$("#fa-sku-step_"+a).find(".fa-spec-input-div").html(""),$("#fa-sku-step_"+a).hasClass("active")&&$("#fa-sku-step_"+a).removeClass("active"),$("#fa-sku-step_"+a).removeClass("ok"),$("#fa-sku-step_"+a).find(".fa-spec-value").attr("title","没有可输入的值");return $(this).val(""),$(this).focus(),!1}$(this).val(e),g=e,m=$(this).attr("spec_value_id");break;case"2":m=$(this).attr("spec_value_id")}uri=ROOT+"api/get_spec_option.html",$.ajax({url:uri,type:"post",data:"fa_id="+fa_id+"&spec_value="+$(this).val()+"&spec_value_id="+m+"&step="+cur_step+"&spec_id="+t,dataType:"json",beforeSend:function(){layer.load(2,{shade:!1}),$("#fa-sku .fa-sku-loading-box").show()},error:function(t,e,a){layer.closeAll(),showErrorMsg("数据异常,请联系管理员！")},success:function(t){layer.closeAll(),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$(".alert").remove();var e="",a="",s="";if(1==t.status){if($("#fa-sku .fa-sku-loading-box").hide(),step_obj=$("#fa-sku-step_"+next_step),last_step_obj=$("#fa-sku-step_"+cur_step),a=step_obj.find(".fa-spec-input-div"),step_obj.hasClass("ok")||step_obj.addClass("ok"),step_obj.find(".fa-spec-value-count").html(t.count),cur_str=last_step_obj.find(".spr").val(),1==last_step_obj.find(".is_ex").val()){var i;i=last_step_obj.find(".is_ex_value").val(),cur_str=cur_str+i+""+g}else cur_str+=g;if(str_arr[parseInt(cur_step)]=cur_str,str_arr.length>cur_step+1)for(var n=parseInt(cur_step)+1;n<str_arr.length;n++)str_arr.remove(parseInt(n));if(spec_arr[parseInt(cur_step)]=t.spec_str,spec_arr.length>cur_step+1)for(var r=parseInt(cur_step)+1;r<spec_arr.length;r++)spec_arr.remove(parseInt(r));if(1!=t.finish&&0<t.count){next_step=parseInt(cur_step)+1,e=a.attr("input_type"),input_spec_id=a.attr("spec_id");var o,l=t.data,c=[];for(var d in l)c.push(l[d]);switch((o=c.sort(function(t,e){return t.val-e.val})).length&&(t.data=o),e){case"0":s+="<select input_type='0' cur_step='"+next_step+"' class='sku-spec sku-ipt' name='spec["+input_spec_id+"]'>",s+="<option value='0'>请选择</option>",$.each(t.data,function(t,e){s+="<option value='"+e.val+"' spec_value_id='"+e.val_id+"'>"+e.val+"</option>"}),s+="</select>";break;case"1":typecodeOptions.isEmpty(),typecodeOptions=new Dictionary,$.each(t.data_arr,function(t,e){typecodeOptions.put(t,e)}),step_arr[next_step]=typecodeOptions,s+="<input input_type='1' size='10' class='sku-spec sku-ipt' name='spec["+input_spec_id+"]' type='text' spec_value_id='"+t.spec_value_id+"'>",step_obj.find(".fa-spec-value-in_"+next_step).html("范围:"+t.data_during);break;case"2":$.each(t.data,function(t,e){s+="<input input_type='2' type='radio' class='sku-spec' spec_value_id='"+e.val_id+"' name='spec["+input_spec_id+"]' value='"+e.val+"' > "+e.val+"<br>"})}a.html(s),$(".fa-sku-step").each(function(){$(this).hasClass("active")&&$(this).removeClass("active")}),step_obj.hasClass("active")||step_obj.addClass("active"),$("#last_spec_id").val(0),$("#is_search_over").val(0),$("#search_price").hasClass("disable")||$("#search_price").addClass("disable"),$(".btn-sku-ex").hasClass("disable")||$(".btn-sku-ex").addClass("disable");for(var p=next_step+1;p<spec_num;p++)$("#fa-sku-step_"+p).find("input:not(.spr,.is_ex,.is_ex_value)").remove(),$("#fa-sku-step_"+p).find(".fa-spec-input-div").html(""),$("#fa-sku-step_"+p).find(".fa-spec-value-count").html("0"),$("#fa-sku-step_"+p).hasClass("ok")&&$("#fa-sku-step_"+p).removeClass("ok")}else 1==t.finish?($("#search_price").hasClass("disable")&&$("#search_price").removeClass("disable"),$(".btn-sku-ex").hasClass("disable")||$(".btn-sku-ex").addClass("disable"),$("#last_spec_id").val(m),$("#is_search_over").val(1),cad_flag=0,$(".sku-add-str").hide(),$("#sku-hidden").html($("#sku-type").val()),$("#sku").width($("#sku-hidden").width()+4),step_obj.hasClass("active")||step_obj.addClass("active"),$(".fa-sku-step").not("#fa-sku-type").each(function(){$(this).hasClass("active")&&$(this).removeClass("active")})):(showErrorMsg("型号参数不正确！"),$("#quantity").val(order_num),$("#last_spec_id").val(0),$("#is_search_over").val(0),$("#search_price").hasClass("disable")||$("#search_price").addClass("disable"),$(".btn-sku-ex").hasClass("disable")||$(".btn-sku-ex").addClass("disable"));for(var u,_,h="",f="",v=0;v<=cur_step;v++)h+=str_arr[parseInt(v)],f+="  "+spec_arr[parseInt(v)];if(u=gen_string+""+h,_=spec_string+f,$("#sku").val(u),$("#spec_str").val(_),1==t.finish?$(".sku-add-str").hide():1!=t.finish&&$(".sku-add-str").show(),$("#sku-hidden").html(u),$("#sku").width($("#sku-hidden").width()+4),1==t.finish){if(search_price(),1==is_show_cad&&1==is_cad)getDrawing($("#sku").val());layer.closeAll()}}else showErrorMsg(t.msg),$("#quantity").val(order_num),$(".fa-price-value").html("-"),$("#last_spec_id").val(0),$("#is_search_over").val(0),$(".sku-add-str").show(),$("#sku-hidden").html($("#sku-type").val()),$("#sku").width($("#sku-hidden").width()+4),$(".btn-sku").hasClass("disable")||$(".btn-sku").addClass("disable")}})}),$("#search_price").on("click",function(){search_price()}),$("#add_collect").on("click",function(){var t=$("#is_search_over").val(),e=$("#quantity").val(),a=$("#sku-type").val(),s=$("#sku").val(),i=$("#is_sku_price").val();return e&&0!=e?t&&0!=t?s&&0!=s?i&&0!=i?void $.ajax({type:"GET",dataType:"json",data:{fa_id:fa_id,sku:s,fa_num:e,typecode:a},url:ROOT+"User/add_collect",success:function(t){1==t.status?layer.msg(t.info,{icon:1,time:2e3}):2==t.status?quicklogin(1):showErrorMsg(t.info)},error:function(t,e,a){showErrorMsg("数据异常")}}):(showErrorMsg("请先查询价格，或此型号未设定价格，无法收藏!"),!1):(showErrorMsg("型号错误或者不完整！"),!1):(showErrorMsg("请生成完整型号！"),!1):(showErrorMsg("请输入数量！"),!1)}),$("#add_cart").on("click",function(){var t=$("#is_search_over").val(),e=$("#is_sku_price").val(),a=$("#quantity").val(),s=$("#sku-type").val(),i=$("#sku").val(),n=$("#spec_str").val();return a&&0!=a?t&&0!=t?i&&0!=i?e&&0!=e?void $.ajax({type:"POST",url:ROOT+"Cart/ajax_fa_add_cart",data:{sku:i,fa_id:fa_id,fa_num:a,typecode:s,spec_str:n},dataType:"json",success:function(t){if(t.status<0)return layer.alert(t.msg,{icon:2}),!1;cart_num=parseInt($(".cart_quantity").html())+parseInt(a),$(".cart_quantity").html(cart_num),layer.open({type:2,title:"加入购物车成功",skin:"layui-layer-rim",area:["490px","386px"],content:[ROOT+"Cart/add_fa_cart?fa_id="+fa_id,"no"],success:function(t,e){layer.iframeAuto(e)}})}}):(showErrorMsg("请先查询价格，或此型号未设定价格，请咨询客服!"),!1):(showErrorMsg("型号错误或者不完整！"),!1):(showErrorMsg("请生成完整型号！"),!1):(showErrorMsg("请输入数量！"),!1)}),$(".fa-con-tab").slide({trigger:"click"}),$(".pin-box-s").pinBox({Top:"0px",Container:".fa-wrap"}),$(".pin-box-m").pinBox({Top:"0px",Container:".fa-main"}),$("#show_remark,#show_faq").click(function(){is_show_cad=0}),$("#show_cad").click(function(){(is_show_cad=1)==$("#is_search_over").val()&&0==cad_flag&&getDrawing($("#sku").val())});var format_id="33";function getDrawing(e){$(".cad-loading").removeClass("hidden"),$(".no-sku").hide(),$(".no-cad-download").hide(),$("#drawings3D").hide(),$(".cad-iframe").hide(),$.ajax({url:ROOT+"Api/get_cad_info.html?sku="+e,type:"GET",dataType:"json",success:function(t){1==t.status?(loadFrame(e),$("#drawings3D").show(),$(".no-cad-download").hide(),$(".cad-download-box").removeClass("hidden"),$("#cad-sku").html(e)):($(".no-cad-download").show(),$(".cad-loading").addClass("hidden")),cad_flag=1},error:function(t){$(".no-cad-download").show(),$(".cad-loading").addClass("hidden")}})}function loadFrame(t){var e=$("#model-viewer-frame");if(Detector.webgl);else;e.attr("src","https://www.traceparts.com/els/forrun/zh/api/viewer/3d?SupplierID=FORRUN&PartNumber="+t),e.css("height",550),e.css("width",940),e.load(function(){$(".cad-iframe").show(),$(".cad-loading").addClass("hidden")})}function downloadDrawing(){layer.confirm("下载将扣除1点积分，确认下载吗？",{btn:["确定","取消"]},function(){var t=$("#sku").val(),e=ROOT+"Api/download_cad.html?sku="+t+"&format_id="+format_id;return $("#btn-cad-download").attr("disabled","disabled").removeClass("btn-submit").html("数据准备中，请稍后..."),$.ajax({url:e,type:"GET",dataType:"json",success:function(t){2==t.status?quicklogin(1):0==t.status?showErrorMsg(t.info):triggerDownloadFile(t.url),$("#btn-cad-download").removeAttr("disabled").addClass("btn-submit").html("下载文件")},error:function(t){showErrorMsg("网络请求失败，请重试！"),$("#btn-cad-download").removeAttr("disabled").addClass("btn-submit").html("下载文件")}}),layer.closeAll(),!0},function(t){return layer.close(t),!1})}function triggerDownloadFile(t){layer.open({type:1,skin:"layui-layer-rim",area:["420px","220px"],title:"下载提示框",content:'<p style="padding:50px 0;text-align:center;"><a class="btn btn-success" target="_blank" href="'+t+'">下载链接</a><br/><br/>鼠标右键点击“下载链接”，选择“另存为”。</p>'})}function setCadFormat(){format_id=$("#select-cad-format").val()}function get_cad_download(t,e){$.ajax({type:"POST",dataType:"json",data:{sku:t,fa_id:e},url:ROOT+"Api/get_cad_download.html",success:function(t){return 1==t.status?($(".fa-con-cad").html(t.info),!0):($(".fa-con-cad").html(t.info),!1)}})}function get_cad_list(t,e){$("#cad_list").html('<p class="tips-loading"><img src="'+STATIC+'images/spin.gif" /></p>'),$.ajax({type:"GET",url:ROOT+"Api/get_cad_list?fa_id="+e+"&p="+t,success:function(t){$("#cad_list").html(""),$("#cad_list").append(t)}})}function ajaxConsult(t,e,a,s){$("#comnent_list").html('<p class="tips-loading"><img src="'+STATIC+'images/spin.gif" /></p>'),$.ajax({type:"GET",url:ROOT+"Api/ajax_comment_list?goods_id="+a+"&type="+t+"&p="+e+"&is_fa="+s,success:function(t){$("#comnent_list").html(""),$("#comnent_list").append(t)}})}function check_form_comment(t){var e=$.trim($('input[name="username"]').val()),a=$.trim($('input[name="contact"]').val()),s=$.trim($('textarea[name="content"]').val()),i=$.trim($('input[name="verify"]').val()),n=$.trim($('input[name="goods_id"]').val()),r=$.trim($('input[name="cate_id"]').val());return 0==e.length?(layer.msg("请输入您的称呼！",{icon:2,time:2e3}),!1):0==a.length?(layer.msg("请填输入联系方式!",{icon:2,time:2e3}),!1):0==s.length?(layer.msg("请填输入咨询内容!",{icon:2,time:2e3}),!1):0==i.length?(layer.msg("请填输入验证码!",{icon:2,time:2e3}),!1):void $.ajax({type:"post",url:ROOT+"Api/comment",data:{username:e,contact:a,content:s,verify:i,goods_id:n,cate_id:r,is_fa:1},dataType:"json",success:function(t){1==t.status?($("#commt-content").val(""),$("#commt-username").val(""),$("#commt-contact").val(""),$("#commt-verify").val(""),$("#commt-captcha").trigger("click"),layer.msg(t.info,{icon:1,time:2e3})):layer.msg(t.info,{icon:2,time:2e3})}})}function download_cad(t,e){layer.confirm("下载将扣除1点积分，确认下载吗？",{btn:["确认","取消"]},function(){return layer.closeAll(),$.ajax({type:"GET",dataType:"json",url:ROOT+"Api/download_cad_old?fa_id="+t+"&cad_id="+e,success:function(t){1==t.status?location.href=t.info:2==t.status?quicklogin():layer.msg(t.info,{icon:2,time:2e3})}}),!0},function(t){return layer.close(t),!1})}$(".comment-type li").click(function(){$(".comment-type li").removeClass("on"),$(this).addClass("on"),comment_type=$(this).data("type"),goods_id=$(this).data("goods_id"),ajaxConsult(comment_type,1,goods_id,1)}),ajaxConsult(0,1,fa_id,1),$(".fa-header-tips").on("click",function(){layer.open({type:1,title:"数量折扣和货期说明",shadeClose:!0,shade:.8,area:["500px","450px"],content:$("#win-fatips-box")})});